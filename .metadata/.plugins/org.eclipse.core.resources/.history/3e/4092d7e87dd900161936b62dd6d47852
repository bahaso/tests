package bahaso.testing.web;

import java.util.ArrayList;
import java.util.HashMap;

import org.bson.Document;
import org.bson.types.ObjectId;
import org.openqa.selenium.By;
import org.openqa.selenium.WebElement;
import org.testng.Assert;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;

import com.mongodb.BasicDBObject;
import com.mongodb.client.MongoCollection;

import bahaso.testing.general.General;
import bahaso.testing.webElement.LandingPage;
import bahaso.testing.webElement.TrueFalsePicture;

public class TrueFalsePicture_TestCase extends General{
	String instruction = "Tentukan benar atau salah berdasarkan gambar berikut ini";
	String question = "Apakah pernyataan ini benar?";
	String description = "Her name is Kevin";
	TrueFalsePicture trueFalsePicture = null;
	LandingPage landingPage = null;
	HashMap<String, String> LoginData = new HashMap<String, String>();
	ArrayList<WebElement> buttonPage = new ArrayList<WebElement>();
	Object answer;
	
	@BeforeMethod
  	public void before() throws InterruptedException {
	  driver = getDriver();
	  LoginData.put("email","reddev");
	  LoginData.put("password","mahendralubis");
	  trueFalsePicture = new TrueFalsePicture(driver);
	  landingPage = new LandingPage(driver);
	  landingPage.doLogin(LoginData);
	  driver.get(baseUrl + "/ngeadmin/previewCaseNewTab/567929fb938e8e0a3a8b457a");
	  
	  //Get Case ID
	  buttonPage = (ArrayList<WebElement>) driver.findElements(By.className("btn-page"));
	  
	  //Get Data from Database
	  MongoCollection<Document> table = db.getCollection("case");
	  BasicDBObject searchQuery = new BasicDBObject();
	  searchQuery.put("_id", new ObjectId(buttonPage.get(0).getAttribute("data-id")));
	  Document cursor = table.find(searchQuery).first();
	  
	  //Convert answer
	  answer = trueFalsePicture.getAnswerData(cursor);
  	}
	
	@Test
  	public void cekAllElement() throws InterruptedException{
		Thread.sleep(2000);
		Assert.assertEquals(trueFalsePicture.getInstruction().getText(), instruction);
		Assert.assertEquals(trueFalsePicture.getQuestion().getText(), question);
		Assert.assertEquals(trueFalsePicture.getDescription().getText(), description);
	}
	
	@Test
  	public void answerRight() throws InterruptedException{
		Thread.sleep(2000);
		TrueFalseListen.answerRight(answer);
		String status[] = TrueFalseListen.getLessonStatus().getAttribute("class").split(" ");
		Assert.assertEquals(status[status.length-1], "true");
	}
	
	@Test
  	public void answerWrong() throws InterruptedException{
		Thread.sleep(2000);
		if(!answer){
			trueFalsePicture.getTrueButton().click();
			trueFalsePicture.getButtonCheck().click();
			Thread.sleep(2000);
			String status[] = trueFalsePicture.getLessonStatus().getAttribute("class").split(" ");
			Assert.assertEquals(status[status.length-1], "false");
		}else{
			trueFalsePicture.getFalseButton().click();
			trueFalsePicture.getButtonCheck().click();
			Thread.sleep(2000);
			String status[] = trueFalsePicture.getLessonStatus().getAttribute("class").split(" ");
			Assert.assertEquals(status[status.length-1], "false");
		}
	}
	
	@AfterMethod
  	public void after() {
  		driver.quit();
  	}
	
}
